# frozen_string_literal: true

require "test_helper"
require "active_support/testing/time_helpers"

class WeatherKitServiceTest < Minitest::Test
  include ActiveSupport::Testing::TimeHelpers

  def test_weather_no_data
    assert_equal({}, WeatherKitService.weather)
  end

  def test_temperature_range_for_no_data
    assert_nil(WeatherKitService.temperature_range_for(Date.today))
  end

  def test_temperature_range_for_example
    weather = {
      "forecastDaily" => {
        "days" => [
          {
            "forecastStart"=>"2023-08-27T06:00:00Z",
            "temperatureMax"=>30.38,
            "temperatureMin"=>14.47,
          },
          {
            "forecastStart"=>"2023-08-28T06:00:00Z",
            "temperatureMax"=>25.32,
            "temperatureMin"=>15.16,
          }
        ]
      }
    }

    WeatherKitService.stub :weather, weather do
      assert_equal("&#8593;87 &#8595;58", WeatherKitService.temperature_range_for(Date.new(2023,8,27)))
    end
  end

  def test_current_temperature_no_data
    assert_nil(WeatherKitService.current_temperature)
  end

  def test_current_temperature
    weather = {
      "currentWeather" =>
        {
          "temperature" => 30.06
        }
    }

    WeatherKitService.stub :weather, weather do
      assert_equal("86Â°", WeatherKitService.current_temperature)
    end
  end

  def test_health_no_data
    assert(WeatherKitService.healthy?)
  end

  def test_health_current_data
    WeatherKitService.stub :last_fetched_at, "2023-08-27 15:14:59 -0600" do
      travel_to DateTime.new(2023,8,27,15,20,0, "-0600") do
        assert(WeatherKitService.healthy?)
      end
    end
  end

  def test_health_stale_data
    WeatherKitService.stub :last_fetched_at, "2023-08-27 15:14:59 -0600" do
      travel_to DateTime.new(2023,8,27,16,20,0,"-0600") do
        refute(WeatherKitService.healthy?)
      end
    end
  end

  def test_calendar_events_no_data
    assert_equal([], WeatherKitService.calendar_events)
  end

  def test_calendar_events_example
    weather = {
      "forecastHourly" => {
        "hours" =>   [{"temperature"=>18.81,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-27T05:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>18.11,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-27T06:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>17.66,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-27T07:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>16.81,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-27T08:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>16.11,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-27T09:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>15.5,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-27T10:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>14.99,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-27T11:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>14.32,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-27T12:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>15.35,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-27T13:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>17.41,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-27T14:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>19.69,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-27T15:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>22.68,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-27T16:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>25.12,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-27T17:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>27.37,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-27T18:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>29.13,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-08-27T19:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>30.08,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-08-27T20:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>29.73,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-08-27T21:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>28.31,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-08-27T22:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>27.6,
          "conditionCode"=>"MostlyCloudy",
          "forecastStart"=>"2023-08-27T23:00:00Z",
          "precipitationType"=>"rain",
          "precipitationIntensity"=>0.6},
         {"temperature"=>25.65,
          "conditionCode"=>"MostlyCloudy",
          "forecastStart"=>"2023-08-28T00:00:00Z",
          "precipitationType"=>"rain",
          "precipitationIntensity"=>1.0},
         {"temperature"=>23.74,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-08-28T01:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>22.43,
          "conditionCode"=>"MostlyCloudy",
          "forecastStart"=>"2023-08-28T02:00:00Z",
          "precipitationType"=>"rain",
          "precipitationIntensity"=>0.3},
         {"temperature"=>20.73,
          "conditionCode"=>"MostlyCloudy",
          "forecastStart"=>"2023-08-28T03:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>20.26,
          "conditionCode"=>"MostlyCloudy",
          "forecastStart"=>"2023-08-28T04:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>19.5,
          "conditionCode"=>"MostlyCloudy",
          "forecastStart"=>"2023-08-28T05:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>18.91,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-08-28T06:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>18.13,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-08-28T07:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>16.87,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-08-28T08:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>16.27,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-08-28T09:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>15.74,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-28T10:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>15.39,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-28T11:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>15.1,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-28T12:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>15.47,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-28T13:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>16.91,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-08-28T14:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>18.92,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-08-28T15:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>20.22,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-08-28T16:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>21.92,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-08-28T17:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>23.64,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-08-28T18:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>25.04,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-08-28T19:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>24.65,
          "conditionCode"=>"MostlyCloudy",
          "forecastStart"=>"2023-08-28T20:00:00Z",
          "precipitationType"=>"rain",
          "precipitationIntensity"=>0.3},
         {"temperature"=>23.98,
          "conditionCode"=>"Drizzle",
          "forecastStart"=>"2023-08-28T21:00:00Z",
          "precipitationType"=>"rain",
          "precipitationIntensity"=>0.4},
         {"temperature"=>24.0,
          "conditionCode"=>"Drizzle",
          "forecastStart"=>"2023-08-28T22:00:00Z",
          "precipitationType"=>"rain",
          "precipitationIntensity"=>1.0},
         {"temperature"=>22.74,
          "conditionCode"=>"Drizzle",
          "forecastStart"=>"2023-08-28T23:00:00Z",
          "precipitationType"=>"rain",
          "precipitationIntensity"=>1.5},
         {"temperature"=>21.85,
          "conditionCode"=>"Drizzle",
          "forecastStart"=>"2023-08-29T00:00:00Z",
          "precipitationType"=>"rain",
          "precipitationIntensity"=>1.1},
         {"temperature"=>21.21,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-08-29T01:00:00Z",
          "precipitationType"=>"rain",
          "precipitationIntensity"=>0.3},
         {"temperature"=>20.22,
          "conditionCode"=>"MostlyCloudy",
          "forecastStart"=>"2023-08-29T02:00:00Z",
          "precipitationType"=>"rain",
          "precipitationIntensity"=>0.3},
         {"temperature"=>19.14,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-08-29T03:00:00Z",
          "precipitationType"=>"rain",
          "precipitationIntensity"=>0.3},
         {"temperature"=>18.33,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-08-29T04:00:00Z",
          "precipitationType"=>"rain",
          "precipitationIntensity"=>0.4},
         {"temperature"=>17.55,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-08-29T05:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>17.03,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-08-29T06:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>16.45,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-29T07:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>15.66,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-29T08:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>15.05,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-29T09:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>14.44,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-29T10:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>13.91,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-29T11:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>13.53,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-29T12:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>14.1,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-29T13:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>15.68,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-29T14:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>17.89,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-29T15:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>20.06,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-29T16:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>22.03,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-29T17:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>23.72,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-08-29T18:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>25.42,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-29T19:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>26.7,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-29T20:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>27.66,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-29T21:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>28.27,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-29T22:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>28.45,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-29T23:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>27.79,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-08-30T00:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>26.46,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-30T01:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>24.31,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-30T02:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>22.81,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-30T03:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>21.4,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-30T04:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>20.19,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-30T05:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>19.23,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-30T06:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>18.4,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-30T07:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>17.41,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-30T08:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>16.71,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-30T09:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>15.8,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-30T10:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>14.99,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-30T11:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>14.2,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-30T12:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>14.95,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-30T13:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>16.81,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-30T14:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>19.98,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-08-30T15:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>23.32,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-30T16:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>26.88,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-30T17:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>29.81,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-30T18:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>31.97,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-08-30T19:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>33.4,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-08-30T20:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>34.28,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-08-30T21:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>34.65,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-08-30T22:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>34.21,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-08-30T23:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>32.83,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-08-31T00:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>30.81,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-08-31T01:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>28.22,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-31T02:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>25.95,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-31T03:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>24.23,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-31T04:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>22.8,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-31T05:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>21.77,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-31T06:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>20.6,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-31T07:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>19.53,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-08-31T08:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>18.67,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-08-31T09:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>17.68,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-08-31T10:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>16.75,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-31T11:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>16.51,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-31T12:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>17.72,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-31T13:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>19.71,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-31T14:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>22.07,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-31T15:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>24.83,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-31T16:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>28.03,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-31T17:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>30.93,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-31T18:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>32.56,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-31T19:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>33.72,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-08-31T20:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>34.45,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-08-31T21:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>34.79,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-08-31T22:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>34.24,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-08-31T23:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>32.9,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-09-01T00:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>30.49,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-09-01T01:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>27.59,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-09-01T02:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>25.02,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-09-01T03:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>23.45,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-09-01T04:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>22.17,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-09-01T05:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>20.81,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-09-01T06:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>19.55,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-09-01T07:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>18.61,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-09-01T08:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>18.1,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-09-01T09:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>17.39,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-09-01T10:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>16.55,
          "conditionCode"=>"MostlyCloudy",
          "forecastStart"=>"2023-09-01T11:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>17.22,
          "conditionCode"=>"MostlyCloudy",
          "forecastStart"=>"2023-09-01T12:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>18.33,
          "conditionCode"=>"MostlyCloudy",
          "forecastStart"=>"2023-09-01T13:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>19.72,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-09-01T14:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>21.72,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-09-01T15:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>24.99,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-09-01T16:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>27.91,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-09-01T17:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>30.2,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-09-01T18:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>31.57,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-09-01T19:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>32.34,
          "conditionCode"=>"MostlyCloudy",
          "forecastStart"=>"2023-09-01T20:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>31.9,
          "conditionCode"=>"MostlyCloudy",
          "forecastStart"=>"2023-09-01T21:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>30.13,
          "conditionCode"=>"MostlyCloudy",
          "forecastStart"=>"2023-09-01T22:00:00Z",
          "precipitationType"=>"rain",
          "precipitationIntensity"=>0.2},
         {"temperature"=>27.87,
          "conditionCode"=>"Cloudy",
          "forecastStart"=>"2023-09-01T23:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>26.44,
          "conditionCode"=>"Cloudy",
          "forecastStart"=>"2023-09-02T00:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>24.68,
          "conditionCode"=>"Cloudy",
          "forecastStart"=>"2023-09-02T01:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>23.34,
          "conditionCode"=>"MostlyCloudy",
          "forecastStart"=>"2023-09-02T02:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>22.21,
          "conditionCode"=>"MostlyCloudy",
          "forecastStart"=>"2023-09-02T03:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>21.38,
          "conditionCode"=>"MostlyCloudy",
          "forecastStart"=>"2023-09-02T04:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>20.4,
          "conditionCode"=>"MostlyCloudy",
          "forecastStart"=>"2023-09-02T05:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>19.74,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-09-02T06:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>18.91,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-09-02T07:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>18.6,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-09-02T08:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>17.98,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-09-02T09:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>17.32,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-09-02T10:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>16.73,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-09-02T11:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>17.06,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-09-02T12:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>18.27,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-09-02T13:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>20.07,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-09-02T14:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>22.12,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-09-02T15:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>24.49,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-09-02T16:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>26.88,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-09-02T17:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>28.67,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-09-02T18:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>29.9,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-09-02T19:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>30.78,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-09-02T20:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>31.17,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-09-02T21:00:00Z",
          "precipitationType"=>"rain",
          "precipitationIntensity"=>0.3},
         {"temperature"=>30.28,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-09-02T22:00:00Z",
          "precipitationType"=>"rain",
          "precipitationIntensity"=>0.3},
         {"temperature"=>28.95,
          "conditionCode"=>"MostlyCloudy",
          "forecastStart"=>"2023-09-02T23:00:00Z",
          "precipitationType"=>"rain",
          "precipitationIntensity"=>0.3},
         {"temperature"=>27.66,
          "conditionCode"=>"Cloudy",
          "forecastStart"=>"2023-09-03T00:00:00Z",
          "precipitationType"=>"rain",
          "precipitationIntensity"=>0.3},
         {"temperature"=>26.92,
          "conditionCode"=>"MostlyCloudy",
          "forecastStart"=>"2023-09-03T01:00:00Z",
          "precipitationType"=>"rain",
          "precipitationIntensity"=>0.3},
         {"temperature"=>25.27,
          "conditionCode"=>"MostlyCloudy",
          "forecastStart"=>"2023-09-03T02:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>23.97,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-09-03T03:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>22.8,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-09-03T04:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>21.46,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-09-03T05:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>20.53,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-09-03T06:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>19.53,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-09-03T07:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>18.72,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-09-03T08:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>17.94,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-09-03T09:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>17.09,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-09-03T10:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>16.32,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-09-03T11:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>16.67,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-09-03T12:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>16.85,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-09-03T13:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>19.05,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-09-03T14:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>21.47,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-09-03T15:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>24.09,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-09-03T16:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>26.69,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-09-03T17:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>28.56,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-09-03T18:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>29.73,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-09-03T19:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>30.48,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-09-03T20:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>30.85,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-09-03T21:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>30.4,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-09-03T22:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>29.59,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-09-03T23:00:00Z",
          "precipitationType"=>"rain",
          "precipitationIntensity"=>0.2},
         {"temperature"=>28.68,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-09-04T00:00:00Z",
          "precipitationType"=>"rain",
          "precipitationIntensity"=>0.3},
         {"temperature"=>27.79,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-09-04T01:00:00Z",
          "precipitationType"=>"rain",
          "precipitationIntensity"=>0.2},
         {"temperature"=>25.83,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-09-04T02:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>24.09,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-09-04T03:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>22.53,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-09-04T04:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>21.16,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-09-04T05:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>20.04,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-09-04T06:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>18.88,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-09-04T07:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>17.9,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-09-04T08:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>17.0,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-09-04T09:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>16.15,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-09-04T10:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>15.56,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-09-04T11:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>15.99,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-09-04T12:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>17.47,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-09-04T13:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>19.78,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-09-04T14:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>22.39,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-09-04T15:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>25.2,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-09-04T16:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>27.92,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-09-04T17:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>29.8,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-09-04T18:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>30.92,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-09-04T19:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>31.59,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-09-04T20:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>31.94,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-09-04T21:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>31.65,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-09-04T22:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>31.14,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-09-04T23:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>30.3,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-09-05T00:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>28.87,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-09-05T01:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>26.78,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-09-05T02:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>24.96,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-09-05T03:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>23.42,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-09-05T04:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>22.06,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-09-05T05:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>20.88,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-09-05T06:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>19.58,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-09-05T07:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>18.4,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-09-05T08:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>17.3,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-09-05T09:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>16.28,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-09-05T10:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>15.54,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-09-05T11:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>15.79,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-09-05T12:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>17.06,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-09-05T13:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>19.12,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-09-05T14:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>21.48,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-09-05T15:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>24.06,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-09-05T16:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>26.58,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-09-05T17:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>28.38,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-09-05T18:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>29.61,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-09-05T19:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>30.51,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-09-05T20:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>31.02,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-09-05T21:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>30.69,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-09-05T22:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>30.01,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-09-05T23:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>29.13,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-09-06T00:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>27.94,
          "conditionCode"=>"PartlyCloudy",
          "forecastStart"=>"2023-09-06T01:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>26.24,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-09-06T02:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>24.71,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-09-06T03:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>23.3,
          "conditionCode"=>"MostlyClear",
          "forecastStart"=>"2023-09-06T04:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>22.02,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-09-06T05:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>20.91,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-09-06T06:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>19.92,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-09-06T07:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>18.83,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-09-06T08:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>18.02,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-09-06T09:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>17.31,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-09-06T10:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>16.65,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-09-06T11:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>16.05,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-09-06T12:00:00Z",
          "precipitationType"=>"clear"},
         {"temperature"=>20.83,
          "conditionCode"=>"Clear",
          "forecastStart"=>"2023-09-06T13:00:00Z",
          "precipitationType"=>"clear"}],
      }
    }

    WeatherKitService.stub :weather, weather do
      travel_to DateTime.new(2023,8,27,16,20,0,"-0600") do
        assert_equal(16, WeatherKitService.calendar_events.length)
      end
    end
  end

  def test_precip_calendar_events_no_data
    assert_equal([], WeatherKitService.precip_calendar_events)
  end
end